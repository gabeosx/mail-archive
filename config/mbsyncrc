# mbsync configuration template for email sync
# This file will be processed by the sync script to substitute environment variables

IMAPAccount email
Host __IMAP_HOST__
Port __IMAP_PORT__
User __EMAIL_USER__
PassCmd "sh -c 'FILE=${EMAIL_PASS_FILE:-/run/secrets/imap_password}; if [ -f "$FILE" ]; then cat "$FILE"; elif [ -n "$EMAIL_PASS" ]; then printf "%s" "$EMAIL_PASS"; else echo "Error: no EMAIL_PASS_FILE or EMAIL_PASS provided" >&2; exit 1; fi'"
TLSType IMAPS
AuthMechs LOGIN
Timeout 120
PipelineDepth 1

# Define the remote IMAP store
IMAPStore email-remote
Account email

# Define the local Maildir store (bind-mounted at /srv/mail/archive)  
MaildirStore email-local
SubFolders Verbatim
Path /srv/mail/archive/
Inbox /srv/mail/archive/INBOX

Channel email-channel
Far :email-remote:
Near :email-local:
Patterns __SYNC_FOLDERS__
Create Near
SyncState *
Sync Pull